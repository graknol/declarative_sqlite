# Registration Builder Changes

## Summary

The registration builder has been simplified to remove unnecessary complexity:

### What Changed

1. **Removed `@RegisterFactory` annotation** - No longer needed
2. **Simplified builder architecture** - Now uses a single builder instead of collect+aggregate pattern
3. **No intermediate JSON files** - Directly scans source files and generates registration code
4. **Automatic detection** - Finds all classes that extend `DbRecord` and have `@GenerateDbRecord`

### Before (Old Way)

```dart
@GenerateDbRecord('users')
@RegisterFactory()  // ❌ No longer needed
class User extends DbRecord {
  User(Map<String, Object?> data, DeclarativeDatabase database)
      : super(data, 'users', database);
}
```

### After (New Way)

```dart
@GenerateDbRecord('users')  // ✅ Only annotation needed
class User extends DbRecord {
  User(Map<String, Object?> data, DeclarativeDatabase database)
      : super(data, 'users', database);
}
```

### How It Works

The new `RegistrationBuilder`:

1. **Scans all Dart files** in `lib/**/*.dart`
2. **Finds eligible classes** that:
   - Extend `DbRecord` 
   - Have `@GenerateDbRecord` annotation
3. **Generates registration file** at `lib/generated_registrations.dart`

### Generated Output

The builder generates a single registration file:

```dart
// GENERATED CODE - DO NOT MODIFY BY HAND
// Generated by declarative_sqlite_generator

import 'package:declarative_sqlite/declarative_sqlite.dart';
import 'package:your_package/src/models/user.dart';
import 'package:your_package/src/models/post.dart';

/// Auto-generated factory registration function
/// Call this function to register all annotated record factories
void registerAllGeneratedFactories(DeclarativeDatabase database) {
  RecordMapFactoryRegistry.register<User>((data, db) => User(data, db));
  RecordMapFactoryRegistry.register<Post>((data, db) => Post(data, db));
}
```

### Usage

```dart
void main() {
  final database = DeclarativeDatabase.open('app.db');
  
  // Register all generated factories
  registerAllGeneratedFactories(database);
  
  // Now you can use the registered factories
  final users = await database.query<User>('SELECT * FROM users');
}
```

### Benefits

- **Simpler API** - Only one annotation needed
- **Less configuration** - No need to manage two separate annotations
- **Better performance** - No intermediate JSON files to read/write
- **Cleaner codebase** - Removes unnecessary complexity